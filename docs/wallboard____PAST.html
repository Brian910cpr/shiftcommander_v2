.wrap{
max-width:1500px;
margin:0 auto;
    padding:12px;
    padding:8px;
}

.week-block{
@@ -84,7 +84,7 @@
background:var(--card);
box-shadow:var(--shadow);
overflow:hidden;
    margin-bottom:12px;
    margin-bottom:8px;
}

.divider{
@@ -95,7 +95,7 @@

.week-head{
display:flex; align-items:center; justify-content:space-between;
    padding:10px 12px;
    padding:8px 10px;
border-bottom:1px solid var(--line2);
background:linear-gradient(#fbfdff,#fff);
gap:12px;
@@ -113,8 +113,8 @@
.weekday-row{
display:grid;
grid-template-columns: repeat(7, 1fr);
    gap:10px;
    padding:10px 12px 0 12px;
    gap:6px;
    padding:6px 8px 0 8px;
color:var(--muted);
font-weight:1000;
font-size:11px;
@@ -125,8 +125,8 @@
.grid{
display:grid;
grid-template-columns: repeat(7, minmax(165px, 1fr));
    gap:10px;
    padding:10px 12px 12px 12px;
    gap:6px;
    padding:6px 8px 8px 8px;
}

/* Day tile */
@@ -145,11 +145,11 @@
.tile{
display:grid;
grid-template-rows: 30px 1fr 1fr; /* head + AM + PM */
    min-height: 142px;
    min-height: 132px;
}
.dayhead{
display:flex; justify-content:space-between; align-items:center;
    padding:6px 10px;
    padding:5px 8px;
border-bottom:1px solid var(--line2);
background:linear-gradient(#fbfdff,#fff);
}
@@ -174,8 +174,8 @@
.slot{
display:grid;
grid-template-columns: 22px 1fr; /* tiny AM/PM + names */
    gap:8px;
    padding:8px 10px;
    gap:6px;
    padding:6px 8px;
border-top:1px solid var(--line2);
align-items:start;
}
@@ -242,9 +242,18 @@

@media (max-width: 980px){
.weekday-row{ display:none; }
    .grid{ grid-template-columns: repeat(2, minmax(160px, 1fr)); }
    .grid{ grid-template-columns: repeat(2, minmax(150px, 1fr)); gap:6px; padding:6px 8px 8px 8px; }
  }

  @media (max-width: 560px){
    .wrap{ padding:6px; }
    .week-head{ padding:8px 8px; }
    .grid{ grid-template-columns: 1fr; gap:6px; padding:6px 8px 8px 8px; }
    .tile{ min-height: 120px; }
    .line{ font-size: clamp(14px, 4.4vw, 18px); }
}


#root{ transition: opacity .22s ease; }

#rangeLabel{ display:none; }
@@ -469,6 +478,33 @@
return t ? String(t) : "";
}


/** ========= SEAT ACTIVITY (from org_settings.active_seats_by_date) ========= **/
function seatsForDateShift(iso, shift, org){
  try{
    const sh = String(shift||"").toUpperCase();
    const day = (org && org.active_seats_by_date && org.active_seats_by_date[iso]) ? org.active_seats_by_date[iso] : null;

    // If the key exists and is an empty array, treat as explicit NONE (no seating required)
    if(day && Object.prototype.hasOwnProperty.call(day, sh)){
      const v = day[sh];
      if(Array.isArray(v)) return v.map(String); // may be []
    }

    // Otherwise fall back to defaults
    const def = org && org.ops_defaults && org.ops_defaults.seats ? (org.ops_defaults.seats[sh] || org.ops_defaults.seats[sh.toLowerCase()]) : null;
    if(Array.isArray(def)) return def.map(String);

    // Unknown (treat as active by default)
    return null;
  }catch(_e){
    return null;
  }
}
function isNoSeating(arr){
  return Array.isArray(arr) && arr.length === 0;
}

/** ========= HEALTH RULES (ALL SHIFTS ARE ALS SHIFTS) ========= **/
function hasQual(member, key){
try{
@@ -482,7 +518,10 @@
}
}

function shiftHealth(attId, drvId, roster, operatorQualKey){
function shiftHealth(attId, drvId, roster, operatorQualKey, seatsArr){
  // If seating is explicitly NONE for this shift, treat as N/A
  if(isNoSeating(seatsArr)) return "GRAY";

// Red if attendant is not ALS, or driver lacks qual_120
const att = roster[attId];
const drv = roster[drvId];
@@ -515,15 +554,21 @@
const amOpKey = operatorQualForDateShift(iso, "AM", org);
const pmOpKey = operatorQualForDateShift(iso, "PM", org);

  // Worst-of (RED beats YELLOW beats GREEN)
  const ranks = { RED:3, YELLOW:2, GREEN:1 };
  const amH = shiftHealth(amA, amD, roster, amOpKey);
  const pmH = shiftHealth(pmA, pmD, roster, pmOpKey);
  const amSeats = seatsForDateShift(iso, "AM", org);
  const pmSeats = seatsForDateShift(iso, "PM", org);

  // Worst-of (RED beats YELLOW beats GREEN; GRAY is N/A)
  const ranks = { RED:3, YELLOW:2, GREEN:1, GRAY:0 };
  const amH = shiftHealth(amA, amD, roster, amOpKey, amSeats);
  const pmH = shiftHealth(pmA, pmD, roster, pmOpKey, pmSeats);

return (ranks[amH] >= ranks[pmH]) ? amH : pmH;
}

/** ========= NEEDS HINTS (ONLY IN LAST PLANNING WEEK) ========= **/
function needsHint(attId, drvId, roster, operatorQualKey){
function needsHint(attId, drvId, roster, operatorQualKey, seatsArr){
  if(isNoSeating(seatsArr)) return "";

// Based on your preferences:
// - If 2 ALS scheduled (ALS attendant + ALS driver w/ 120) => Needs EMT
// - If ALS attendant but driver missing or lacks required operator qual => Need Driver
@@ -642,9 +687,14 @@
const [amA, amD] = dayObj.am;
const [pmA, pmD] = dayObj.pm;

    const amSeats = seatsForDateShift(iso, "AM", org);
    const pmSeats = seatsForDateShift(iso, "PM", org);
    const amNoSeat = isNoSeating(amSeats);
    const pmNoSeat = isNoSeating(pmSeats);

// Planning “Needs …” only in last planning week block
    const amNeed = opts.showNeeds ? needsHint(amA, amD, roster, operatorQualForDateShift(iso, "AM", org)) : "";
    const pmNeed = opts.showNeeds ? needsHint(pmA, pmD, roster, operatorQualForDateShift(iso, "PM", org)) : "";
    const amNeed = opts.showNeeds ? needsHint(amA, amD, roster, operatorQualForDateShift(iso, "AM", org), seatsForDateShift(iso, "AM", org)) : "";
    const pmNeed = opts.showNeeds ? needsHint(pmA, pmD, roster, operatorQualForDateShift(iso, "PM", org), seatsForDateShift(iso, "PM", org)) : "";

tile.innerHTML = `
     <div class="dayhead">
@@ -656,18 +706,20 @@
     <div class="slot">
       <div class="tag">AM</div>
       <div class="lines">
          <div class="line">${nameFor(amA, roster)}</div>
          <div class="line">${nameFor(amD, roster)}</div>
          ${amNeed ? `<div class="note needs"><strong>${escapeHtml(amNeed)}</strong></div>` : ""}
          ${amNoSeat
            ? `<div class="line open">N/A</div><div class="note">No seating required</div>`
            : `<div class="line">${nameFor(amA, roster)}</div><div class="line">${nameFor(amD, roster)}</div>${amNeed ? `<div class="note needs"><strong>${escapeHtml(amNeed)}</strong></div>` : ""}`
          }
       </div>
     </div>

     <div class="slot">
       <div class="tag">PM</div>
       <div class="lines">
          <div class="line">${nameFor(pmA, roster)}</div>
          <div class="line">${nameFor(pmD, roster)}</div>
          ${pmNeed ? `<div class="note needs"><strong>${escapeHtml(pmNeed)}</strong></div>` : ""}
          ${pmNoSeat
            ? `<div class="line open">N/A</div><div class="note">No seating required</div>`
            : `<div class="line">${nameFor(pmA, roster)}</div><div class="line">${nameFor(pmD, roster)}</div>${pmNeed ? `<div class="note needs"><strong>${escapeHtml(pmNeed)}</strong></div>` : ""}`
          }
       </div>
     </div>
   `;
@@ -758,7 +810,7 @@
const data = await loadData();

// Visible “did the update push?” marker (build tag)
    document.getElementById("buildTag").textContent = "v2026-01-16.6";
    document.getElementById("buildTag").textContent = "v2026-01-16.7";

// Only re-render if something actually changed
window.__sc_lastHash ||= "";